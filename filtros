# üìò C√≥digo Completo - Sistema de Filtros com View `leiloes_imoveis_com_zona`

Este documento cont√©m **todo o c√≥digo necess√°rio** para implementar o sistema completo de filtros usando a view `leiloes_imoveis_com_zona` do Supabase.

---

## üìã √çndice

1. [Estrutura de Arquivos](#1-estrutura-de-arquivos)
2. [Hook de Filtros (useFilterParams)](#2-hook-de-filtros-usefilterparams)
3. [Utilit√°rios (stringUtils)](#3-utilit√°rios-stringutils)
4. [Componente Principal com Filtros](#4-componente-principal-com-filtros)
5. [Configura√ß√µes e Constantes](#5-configura√ß√µes-e-constantes)

---

## 1. Estrutura de Arquivos

```
src/
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îî‚îÄ‚îÄ useFilterParams.tsx      # Hook para gerenciar filtros na URL
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ stringUtils.ts            # Utilit√°rios (sanitiza√ß√£o, escape SQL)
‚îî‚îÄ‚îÄ pages/
    ‚îî‚îÄ‚îÄ Index.tsx                 # P√°gina principal com filtros
```

---

## 2. Hook de Filtros (`useFilterParams.tsx`)

**Arquivo:** `src/hooks/useFilterParams.tsx`

```typescript
import { useSearchParams } from 'react-router-dom';
import { useCallback } from 'react';

// Interface para os filtros base
export interface FilterParams {
  city?: string;
  type?: string;
  neighborhood?: string;
  location?: string;
  keyword?: string;
  hasSecondAuction?: boolean;
  priceRange?: {
    min?: number;
    max?: number;
  };
  priceRanges?: string[]; // Para m√∫ltiplas faixas de pre√ßo selecionadas
  financiamento?: boolean;
  fgts?: boolean;
  parcelamento?: boolean;
  auctionType?: string;
  neighborhoods?: string[]; // Para m√∫ltiplos bairros
  cities?: string[]; // Para m√∫ltiplas cidades
  dataFimSegundoLeilao?: string; // Data final do filtro de data de encerramento do segundo leil√£o
  zone?: string; // Para zonas (ex: "Zona Sul (Rio de Janeiro)")
  zones?: string[]; // Para m√∫ltiplas zonas (ex: ["Zona Sul (Rio de Janeiro)", "Zona Norte (Rio de Janeiro)"])
}

// Tipos para as faixas de pre√ßo
export interface PriceRange {
  label: string;
  min?: number;
  max?: number;
}

// Tipos para o tipo selecionado
export interface SelectedType {
  label: string;
  icon: JSX.Element;
  originalValue?: string;
}

export const useFilterParams = () => {
  const [searchParams, setSearchParams] = useSearchParams();

  // Fun√ß√£o para converter params da URL para objeto de filtros
  const parseFiltersFromURL = useCallback((): FilterParams => {
    const filters: FilterParams = {};
    
    // Leitura direta e simples
    const city = searchParams.get('cidade');
    if (city) filters.city = city;

    const type = searchParams.get('tipo');
    if (type) filters.type = type;

    const neighborhood = searchParams.get('bairro');
    if (neighborhood) filters.neighborhood = neighborhood;

    const location = searchParams.get('localizacao');
    if (location) filters.location = location;

    const keyword = searchParams.get('palavra_chave');
    if (keyword) filters.keyword = keyword;

    const auctionType = searchParams.get('tipo_leilao');
    if (auctionType) filters.auctionType = auctionType;

    // Par√¢metros booleanos
    const hasSecondAuction = searchParams.get('segundo_leilao');
    if (hasSecondAuction === 'true') filters.hasSecondAuction = true;

    const financiamento = searchParams.get('financiamento');
    if (financiamento === 'true') filters.financiamento = true;

    const fgts = searchParams.get('fgts');
    if (fgts === 'true') filters.fgts = true;

    const parcelamento = searchParams.get('parcelamento');
    if (parcelamento === 'true') filters.parcelamento = true;

    // Faixa de pre√ßo
    const minPrice = searchParams.get('preco_min');
    const maxPrice = searchParams.get('preco_max');
    if (minPrice || maxPrice) {
      filters.priceRange = {};
      if (minPrice) filters.priceRange.min = parseInt(minPrice);
      if (maxPrice) filters.priceRange.max = parseInt(maxPrice);
    }

    // Filtro de data de encerramento do segundo leil√£o
    const dataFimSegundoLeilao = searchParams.get('data_fim_segundo_leilao');
    if (dataFimSegundoLeilao) filters.dataFimSegundoLeilao = dataFimSegundoLeilao;

    // M√∫ltiplas faixas de pre√ßo selecionadas
    const priceRanges = searchParams.get('faixas_preco');
    if (priceRanges) {
      filters.priceRanges = priceRanges.split(',').map(r => r.trim()).filter(Boolean);
    }

    // Arrays para m√∫ltiplos valores (usando v√≠rgula simples)
    const neighborhoods = searchParams.get('bairros');
    if (neighborhoods) {
      filters.neighborhoods = neighborhoods.split(',').map(n => n.trim()).filter(Boolean);
    }

    const cities = searchParams.get('cidades');
    if (cities) {
      filters.cities = cities.split(',').map(c => c.trim()).filter(Boolean);
    }

    // Par√¢metro de zona
    const zone = searchParams.get('zona');
    if (zone) {
      filters.zone = zone;
    }

    // Par√¢metro de m√∫ltiplas zonas
    const zones = searchParams.get('zonas');
    if (zones) {
      filters.zones = zones.split(',').map(z => z.trim()).filter(Boolean);
    }

    return filters;
  }, [searchParams]);

  // Fun√ß√£o para atualizar a URL com os filtros
  const updateURL = useCallback((filters: FilterParams) => {
    const newParams = new URLSearchParams();
    
    // Adicionar par√¢metros de forma direta
    if (filters.city) newParams.set('cidade', filters.city);
    if (filters.type) newParams.set('tipo', filters.type);
    if (filters.neighborhood) newParams.set('bairro', filters.neighborhood);
    if (filters.location) newParams.set('localizacao', filters.location);
    if (filters.keyword) newParams.set('palavra_chave', filters.keyword);
    if (filters.auctionType) newParams.set('tipo_leilao', filters.auctionType);

    // Adicionar par√¢metros booleanos
    if (filters.hasSecondAuction) newParams.set('segundo_leilao', 'true');
    if (filters.financiamento) newParams.set('financiamento', 'true');
    if (filters.fgts) newParams.set('fgts', 'true');
    if (filters.parcelamento) newParams.set('parcelamento', 'true');

    // Adicionar faixa de pre√ßo
    if (filters.priceRange?.min) newParams.set('preco_min', filters.priceRange.min.toString());
    if (filters.priceRange?.max) newParams.set('preco_max', filters.priceRange.max.toString());

    // Adicionar filtro de data de encerramento do segundo leil√£o
    if (filters.dataFimSegundoLeilao) newParams.set('data_fim_segundo_leilao', filters.dataFimSegundoLeilao);

    // Adicionar m√∫ltiplas faixas de pre√ßo
    if (filters.priceRanges && filters.priceRanges.length > 0) {
      newParams.set('faixas_preco', filters.priceRanges.join(','));
    }

    // Adicionar arrays (v√≠rgula simples)
    if (filters.neighborhoods && filters.neighborhoods.length > 0) {
      newParams.set('bairros', filters.neighborhoods.join(','));
    }
    if (filters.cities && filters.cities.length > 0) {
      newParams.set('cidades', filters.cities.join(','));
    }

    // Adicionar par√¢metro de zona
    if (filters.zone) {
      newParams.set('zona', filters.zone);
    }

    // Adicionar par√¢metro de m√∫ltiplas zonas
    if (filters.zones && filters.zones.length > 0) {
      newParams.set('zonas', filters.zones.join(','));
    }

    setSearchParams(newParams, { replace: true });
  }, [setSearchParams]);

  // Fun√ß√£o para limpar todos os filtros da URL
  const clearFiltersFromURL = useCallback(() => {
    setSearchParams({}, { replace: true });
  }, [setSearchParams]);

  // Fun√ß√£o para obter URL share√°vel atual
  const getShareableURL = useCallback(() => {
    const currentURL = window.location.href;
    return currentURL;
  }, []);

  // Fun√ß√£o para criar URL share√°vel com filtros espec√≠ficos
  const createShareableURL = useCallback((filters: FilterParams) => {
    const newParams = new URLSearchParams();
    
    // USAR EXATAMENTE A MESMA L√ìGICA que updateURL
    if (filters.city) newParams.set('cidade', filters.city);
    if (filters.type) newParams.set('tipo', filters.type);
    if (filters.neighborhood) newParams.set('bairro', filters.neighborhood);
    if (filters.location) newParams.set('localizacao', filters.location);
    if (filters.keyword) newParams.set('palavra_chave', filters.keyword);
    if (filters.auctionType) newParams.set('tipo_leilao', filters.auctionType);

    if (filters.hasSecondAuction) newParams.set('segundo_leilao', 'true');
    if (filters.financiamento) newParams.set('financiamento', 'true');
    if (filters.fgts) newParams.set('fgts', 'true');
    if (filters.parcelamento) newParams.set('parcelamento', 'true');

    if (filters.priceRange?.min) newParams.set('preco_min', filters.priceRange.min.toString());
    if (filters.priceRange?.max) newParams.set('preco_max', filters.priceRange.max.toString());

    if (filters.dataFimSegundoLeilao) newParams.set('data_fim_segundo_leilao', filters.dataFimSegundoLeilao);

    if (filters.priceRanges && filters.priceRanges.length > 0) {
      newParams.set('faixas_preco', filters.priceRanges.join(','));
    }

    if (filters.neighborhoods && filters.neighborhoods.length > 0) {
      newParams.set('bairros', filters.neighborhoods.join(','));
    }
    if (filters.cities && filters.cities.length > 0) {
      newParams.set('cidades', filters.cities.join(','));
    }

    // Adicionar par√¢metro de zona
    if (filters.zone) {
      newParams.set('zona', filters.zone);
    }

    // Adicionar par√¢metro de m√∫ltiplas zonas
    if (filters.zones && filters.zones.length > 0) {
      newParams.set('zonas', filters.zones.join(','));
    }

    const baseURL = window.location.origin + window.location.pathname;
    return newParams.toString() ? `${baseURL}?${newParams.toString()}` : baseURL;
  }, []);

  return {
    parseFiltersFromURL,
    updateURL,
    clearFiltersFromURL,
    getShareableURL,
    createShareableURL,
    searchParams
  };
};
```

---

## 3. Utilit√°rios (`stringUtils.ts`)

**Arquivo:** `src/utils/stringUtils.ts`

```typescript
// Fun√ß√£o para remover acentos e normalizar strings para busca
export const normalizeString = (str: string): string => {
  return str
    .toLowerCase()
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '') // Remove acentos
    .replace(/[^\w\s]/g, '') // Remove caracteres especiais exceto espa√ßos
    .trim();
};

// Fun√ß√£o para verificar se uma string cont√©m outra de forma flex√≠vel
export const flexibleIncludes = (text: string, search: string): boolean => {
  if (!search.trim()) return true;
  
  const normalizedText = normalizeString(text);
  const normalizedSearch = normalizeString(search);
  
  return normalizedText.includes(normalizedSearch);
};

// Fun√ß√£o para busca ainda mais flex√≠vel que permite palavras em qualquer ordem
export const flexibleSearch = (text: string, search: string): boolean => {
  if (!search.trim()) return true;
  
  const normalizedText = normalizeString(text);
  const searchWords = normalizeString(search).split(/\s+/);
  
  // Verifica se todas as palavras da busca est√£o presentes no texto
  return searchWords.every(word => normalizedText.includes(word));
};

// Fun√ß√£o para formatar valores monet√°rios em Real
export const formatCurrency = (value: number): string => {
  return new Intl.NumberFormat('pt-BR', {
    style: 'currency',
    currency: 'BRL'
  }).format(value);
};

// Fun√ß√£o para escapar caracteres especiais em consultas SQL ilike
export const escapeSqlLike = (str: string): string => {
  if (!str) return '';
  
  // Escapar caracteres especiais do SQL LIKE
  return str
    .replace(/\\/g, '\\\\')  // Escapar barras invertidas primeiro
    .replace(/%/g, '\\%')    // Escapar percentuais
    .replace(/_/g, '\\_')    // Escapar underscores
    .replace(/'/g, "''");    // Escapar aspas simples (duplicar)
};

// Fun√ß√£o para sanitizar entrada de busca, removendo caracteres problem√°ticos
export const sanitizeSearchInput = (str: string): string => {
  if (!str) return '';
  
  // Remover caracteres que podem causar problemas em consultas SQL
  return str
    .replace(/[,;]/g, '')  // Remover v√≠rgulas e ponto e v√≠rgula
    .trim();               // Remover espa√ßos extras
};
```

---

## 4. Componente Principal com Filtros

**Arquivo:** `src/pages/Index.tsx`

Este √© o componente completo com todos os filtros e front-end. O c√≥digo √© muito extenso, ent√£o vou criar em partes:

### 4.1. Imports e Interfaces

```typescript
import { CookieBar } from "@/components/CookieBar";
import { SocialBar } from "@/components/SocialBar";
import { Header } from "@/components/Header";
import { HeroSection } from "@/components/HeroSection";
import { PropertyCard } from "@/components/PropertyCard";
import { PropertyPagination } from "@/components/PropertyPagination";
import { FeaturedVideos } from "@/components/FeaturedVideos";
import { SuccessCases } from "@/components/SuccessCases";
import { ArticlesSection } from "@/components/articles";
import { VideoPlayerContainer } from "@/components/video";
import { TestimonialsSection } from "@/components/testimonials";
import { NewsletterBottomSection } from "@/components/NewsletterBottomSection";
import { Footer } from "@/components/Footer";
import OpportunityPopup from "@/components/OpportunityPopup";
import { Search, MessageCircle, Filter, X, MapPin, ChevronDown, Home, Building, Tractor, Trees, FileText, Globe, DollarSign, CalendarIcon, Car, SquareStack, Warehouse, Gavel, Mail } from "lucide-react";
import { WhatsAppIcon } from "@/components/icons";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { useState, useEffect } from "react";
import { supabase } from "@/integrations/supabase/client";
import { toast } from "sonner";
import { flexibleSearch, escapeSqlLike, sanitizeSearchInput } from "@/utils/stringUtils";
import { useFilterParams, FilterParams } from "@/hooks/useFilterParams";
import { executeWhatsAppAction, initializeWhatsAppScript } from "@/utils/whatsappScript";
import { SEO } from "@/components/SEO";

// Interface para os dados dos im√≥veis
interface Property {
  id: number;
  titulo_propriedade: string;
  endereco: string;
  bairro: string;
  cidade: string;
  estado: string;
  data_leilao_1: string;
  data_leilao_2: string;
  leilao_1: number;
  leilao_2: number;
  area_displayable?: string;
  parkingSpots?: string;
  imagem: string;
  descricao?: string;
  tipo_leilao?: string;
  fgts?: boolean;
  financiamento?: boolean;
  parcelamento?: boolean;
  zona?: string; // Campo de zona da view
}

// Interface para os filtros
interface Filters {
  city?: string;
  type?: string;
  neighborhood?: string;
  location?: string;
  keyword?: string;
  hasSecondAuction?: boolean;
  priceRange?: {
    min?: number;
    max?: number;
  };
  priceRanges?: string[];
  auctionType?: string;
  financiamento?: boolean;
  fgts?: boolean;
  parcelamento?: boolean;
  dataFimSegundoLeilao?: string;
  zone?: string;
  zones?: string[];
}

// Interface para as faixas de pre√ßo
interface PriceRange {
  label: string;
  min?: number;
  max?: number;
}

// Interface para o tipo selecionado
interface SelectedType {
  label: string;
  icon: JSX.Element;
  originalValue?: string;
}

const ITEMS_PER_PAGE = 40;
```

### 4.2. Constantes de Faixas de Pre√ßo e Tipos de Leil√£o

```typescript
// Faixas de pre√ßo dispon√≠veis
const priceRanges: PriceRange[] = [
  { label: 'Todos os pre√ßos' },
  { label: 'At√© R$ 300k', max: 300000 },
  { label: 'R$ 300k a R$ 500k', min: 300000, max: 500000 },
  { label: 'R$ 500k a R$ 750k', min: 500000, max: 750000 },
  { label: 'R$ 750k a R$ 1M', min: 750000, max: 1000000 },
  { label: 'R$ 1M a R$ 1.5M', min: 1000000, max: 1500000 },
  { label: 'R$ 1.5M a R$ 2M', min: 1500000, max: 2000000 },
  { label: 'Acima de R$ 2M', min: 2000000 }
];

const AUCTION_TYPE_JUDICIAL = "JUDICIAL";
const AUCTION_TYPE_EXTRAJUDICIAL = "EXTRAJUDICIAL";
const AUCTION_TYPE_EXTRAJUDICIAL_FINANCIAMENTO = "EXTRAJUDICIAL FINANCI√ÅVEL";
```

### 4.3. Componente Principal - Estados e Hooks

```typescript
const Index = () => {
  // Estados para os im√≥veis e pagina√ß√£o
  const [properties, setProperties] = useState<Property[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [currentPage, setCurrentPage] = useState(1);
  const [totalPages, setTotalPages] = useState(1);
  const [totalCount, setTotalCount] = useState(0);
  const [filtersLoaded, setFiltersLoaded] = useState(false);

  // Estados para os filtros
  const [filters, setFilters] = useState<Filters>({});
  const [selectedType, setSelectedType] = useState<SelectedType>({ label: "Todos os im√≥veis", icon: <Globe className="h-4 w-4" /> });
  const [selectedTypes, setSelectedTypes] = useState<SelectedType[]>([]);
  const [selectedCity, setSelectedCity] = useState("Selecione a cidade");
  const [selectedCityName, setSelectedCityName] = useState("");
  const [selectedCities, setSelectedCities] = useState<string[]>([]);
  const [selectedNeighborhood, setSelectedNeighborhood] = useState("Selecione o bairro");
  const [selectedNeighborhoods, setSelectedNeighborhoods] = useState<string[]>([]);
  const [selectedPriceRange, setSelectedPriceRange] = useState<PriceRange>({ label: "Todos os pre√ßos" });
  const [selectedPriceRanges, setSelectedPriceRanges] = useState<PriceRange[]>([]);
  const [selectedAuctionType, setSelectedAuctionType] = useState("Todos os tipos de leil√£o");
  const [selectedAuctionTypes, setSelectedAuctionTypes] = useState<string[]>([]);
  const [locationInput, setLocationInput] = useState("");
  const [keywordInput, setKeywordInput] = useState("");
  const [filterSecondAuction, setFilterSecondAuction] = useState(false);
  const [dataFimSegundoLeilao, setDataFimSegundoLeilao] = useState("");

  // Estados para os menus dropdown
  const [showTypeMenu, setShowTypeMenu] = useState(false);
  const [showCityMenu, setShowCityMenu] = useState(false);
  const [showNeighborhoodMenu, setShowNeighborhoodMenu] = useState(false);
  const [showPriceMenu, setShowPriceMenu] = useState(false);
  const [showAuctionTypeMenu, setShowAuctionTypeMenu] = useState(false);
  const [citySearchTerm, setCitySearchTerm] = useState("");
  const [neighborhoodSearchTerm, setNeighborhoodSearchTerm] = useState("");

  // Estados para dados do banco
  const [rjCities, setRjCities] = useState<Array<{ city: string; count: number }>>([]);
  const [propertyTypes, setPropertyTypes] = useState<Array<{ type: string; count: number }>>([]);
  const [rjNeighborhoods, setRjNeighborhoods] = useState<any>([]);
  const [zones, setZones] = useState<string[]>([]); // Zonas dispon√≠veis da view

  // Estados para mobile
  const [isMobile, setIsMobile] = useState(false);
  const [isFilterOpen, setIsFilterOpen] = useState(false);

  // Hook para gerenciar sincroniza√ß√£o com URL
  const { parseFiltersFromURL, updateURL, clearFiltersFromURL } = useFilterParams();

  // Carregar script do WhatsApp automaticamente
  useEffect(() => {
    initializeWhatsAppScript();
  }, []);
```

### 4.4. Carregar Cidades, Tipos e Zonas da View

```typescript
  // Carregar as cidades do estado RJ da view
  useEffect(() => {
    const fetchRjCities = async () => {
      try {
        const cityCount: Record<string, number> = {};
        
        // Buscar todos os registros com pagina√ß√£o da VIEW
        let page = 0;
        const pageSize = 1000;
        let hasMore = true;
        
        while (hasMore) {
          const from = page * pageSize;
          const to = from + pageSize - 1;
          
          const { data, error, count } = await supabase
            .from('leiloes_imoveis_com_zona') // ‚¨ÖÔ∏è USAR A VIEW
            .select('cidade', { count: 'exact' })
            .eq('estado', 'RJ')
            .gte('leilao_1', 75000)
            .order('cidade')
            .not('cidade', 'is', null)
            .range(from, to);
          
          if (error) throw error;
          
          data.forEach(item => {
            if (item.cidade && item.cidade.trim() !== '') {
              cityCount[item.cidade] = (cityCount[item.cidade] || 0) + 1;
            }
          });
          
          hasMore = data.length === pageSize;
          page++;
          
          if (page > 50) break;
        }
        
        const citiesArray = Object.keys(cityCount)
          .map(city => ({
            city,
            count: cityCount[city]
          }))
          .sort((a, b) => {
            if (b.count !== a.count) {
              return b.count - a.count;
            }
            return a.city.localeCompare(b.city, 'pt-BR');
          });
        
        setRjCities(citiesArray);
      } catch (err) {
        console.error('Erro ao buscar cidades do RJ:', err);
      }
    };

    // Buscar tipos de propriedade da VIEW
    const fetchPropertyTypes = async () => {
      try {
        const { data, error } = await supabase
          .from('leiloes_imoveis_com_zona') // ‚¨ÖÔ∏è USAR A VIEW
          .select('tipo_propriedade')
          .eq('estado', 'RJ')
          .gte('leilao_1', 75000)
          .not('tipo_propriedade', 'is', null);
          
        if (error) throw error;
        
        const typeCount: Record<string, number> = {};
        data.forEach(item => {
          if (item.tipo_propriedade && item.tipo_propriedade.trim() !== '') {
            typeCount[item.tipo_propriedade] = (typeCount[item.tipo_propriedade] || 0) + 1;
          }
        });
        
        const typesArray = Object.keys(typeCount)
          .map(type => ({
            type,
            count: typeCount[type]
          }))
          .sort((a, b) => a.type.localeCompare(b.type, 'pt-BR'));
        
        setPropertyTypes(typesArray);
      } catch (err) {
        console.error('Erro ao buscar tipos de propriedade:', err);
      }
    };

    // Buscar zonas dispon√≠veis da VIEW
    const fetchZones = async () => {
      try {
        const { data, error } = await supabase
          .from('leiloes_imoveis_com_zona') // ‚¨ÖÔ∏è USAR A VIEW
          .select('zona')
          .eq('estado', 'RJ')
          .gte('leilao_1', 75000)
          .not('zona', 'is', null);
          
        if (error) throw error;
        
        // Obter zonas √∫nicas
        const uniqueZones = [...new Set(data.map(item => item.zona).filter(Boolean))];
        setZones(uniqueZones.sort());
      } catch (err) {
        console.error('Erro ao buscar zonas:', err);
      }
    };

    fetchRjCities();
    fetchPropertyTypes();
    fetchZones();
  }, []);
```

### 4.5. Carregar Filtros da URL

```typescript
  // Carregar filtros da URL quando a p√°gina carrega
  useEffect(() => {
    const urlFilters = parseFiltersFromURL();
    if (Object.keys(urlFilters).length > 0) {
      // Sincronizar estados visuais com os filtros da URL
      if (urlFilters.city) {
        const cities = urlFilters.city.split(',');
        if (cities.length > 1) {
          setSelectedCities(cities);
          setSelectedCity(`${cities.length} cidades selecionadas`);
        } else {
          setSelectedCity(cities[0]);
        }
      }
      
      if (urlFilters.type) {
        const types = urlFilters.type.split(',');
        if (types.length > 1) {
          const typeObjects = types.map(type => ({ 
            label: type, 
            icon: <Home className="h-4 w-4" />,
            originalValue: type 
          }));
          setSelectedTypes(typeObjects);
          setSelectedType({ label: `${types.length} tipos selecionados`, icon: <Home className="h-4 w-4" /> });
        } else {
          setSelectedType({ label: types[0], icon: <Home className="h-4 w-4" />, originalValue: types[0] });
        }
      }
      
      // ‚¨áÔ∏è FILTRO DE ZONA - DIRETO DA VIEW ‚¨áÔ∏è
      if (urlFilters.zones && urlFilters.zones.length > 0) {
        // M√∫ltiplas zonas selecionadas
        setSelectedNeighborhood(`${urlFilters.zones.length} zonas selecionadas`);
      } else if (urlFilters.zone) {
        // Uma zona selecionada
        setSelectedNeighborhood(`${urlFilters.zone} (todos)`);
      } else if (urlFilters.neighborhood) {
        const neighborhoods = urlFilters.neighborhood.split(',');
        if (neighborhoods.length > 1) {
          setSelectedNeighborhoods(neighborhoods);
          setSelectedNeighborhood(`${neighborhoods.length} bairros selecionados`);
        } else {
          setSelectedNeighborhood(neighborhoods[0]);
        }
      }
      
      // Inicializar m√∫ltiplas faixas de pre√ßo se existirem na URL
      if (urlFilters.priceRanges && urlFilters.priceRanges.length > 0) {
        const rangeObjects: PriceRange[] = [];
        urlFilters.priceRanges.forEach(rangeLabel => {
          const matchedRange = priceRanges.find(r => r.label === rangeLabel);
          if (matchedRange) {
            rangeObjects.push(matchedRange);
          }
        });
        if (rangeObjects.length > 0) {
          setSelectedPriceRanges(rangeObjects);
          if (rangeObjects.length === 1) {
            setSelectedPriceRange(rangeObjects[0]);
          } else {
            setSelectedPriceRange({ label: `${rangeObjects.length} faixas selecionadas` });
          }
        }
      } else if (urlFilters.priceRange) {
        const range = urlFilters.priceRange;
        const matchedRange = priceRanges.find(r => r.min === range.min && r.max === range.max);
        if (matchedRange) {
          setSelectedPriceRange(matchedRange);
          setSelectedPriceRanges([matchedRange]);
        }
      }
      
      if (urlFilters.auctionType) {
        setSelectedAuctionType(urlFilters.auctionType);
        
        if (urlFilters.auctionType === "EXTRAJUDICIAL_COMPOSTO") {
          setSelectedAuctionTypes([AUCTION_TYPE_EXTRAJUDICIAL, AUCTION_TYPE_EXTRAJUDICIAL_FINANCIAMENTO]);
        } else if (urlFilters.auctionType === "EXTRAJUDICIAL_CUSTOM") {
          if (urlFilters.financiamento === true) {
            setSelectedAuctionTypes([AUCTION_TYPE_EXTRAJUDICIAL_FINANCIAMENTO]);
          } else {
            setSelectedAuctionTypes([AUCTION_TYPE_EXTRAJUDICIAL]);
          }
        } else if (urlFilters.auctionType === "Judicial") {
          setSelectedAuctionTypes([AUCTION_TYPE_JUDICIAL]);
        }
      }
      
      if (urlFilters.hasSecondAuction) {
        setFilterSecondAuction(true);
      }
      
      if (urlFilters.location) {
        setLocationInput(urlFilters.location);
      }
      
      if (urlFilters.keyword) {
        setKeywordInput(urlFilters.keyword);
      }
      
      if (urlFilters.dataFimSegundoLeilao) {
        setDataFimSegundoLeilao(urlFilters.dataFimSegundoLeilao);
      }
      
      // Aplicar os filtros vindos da URL
      if (urlFilters.auctionType === "EXTRAJUDICIAL_COMPOSTO") {
        const correctedFilters = { ...urlFilters, financiamento: undefined };
        setFilters(correctedFilters);
      } else {
        setFilters(urlFilters);
      }
    }
    setFiltersLoaded(true);
  }, []);
```

### 4.6. Query Principal - Buscar Im√≥veis da VIEW

```typescript
  // Carregar os im√≥veis do Supabase com filtros - USANDO A VIEW
  useEffect(() => {
    if (!filtersLoaded) return;
    
    const fetchProperties = async () => {
      setLoading(true);
      setError(null);
      
      try {
        // ‚¨áÔ∏è QUERY BASE - USANDO A VIEW leiloes_imoveis_com_zona ‚¨áÔ∏è
        let query = supabase
          .from('leiloes_imoveis_com_zona') // ‚¨ÖÔ∏è VIEW COM ZONA
          .select('*', { count: 'exact' })
          .eq('estado', 'RJ')
          .gte('leilao_1', 75000);
          
        // FILTRO DE CIDADE
        if (filters.city) {
          const cidades = filters.city.split(',').map(c => c.trim()).filter(Boolean);
          if (cidades.length > 1) {
            query = query.in('cidade', cidades);
          } else {
            query = query.eq('cidade', filters.city);
          }
        }
        
        // FILTRO DE TIPO
        if (filters.type && filters.type !== "Todos os im√≥veis") {
          const tipos = filters.type.split(',').map(t => t.trim()).filter(Boolean);
          if (tipos.length > 1) {
            query = query.in('tipo_propriedade', tipos);
          } else {
            query = query.eq('tipo_propriedade', filters.type);
          }
        }
        
        // ‚¨áÔ∏è FILTRO DE ZONA - DIRETO DA VIEW (SEM EXPANDIR PARA BAIRROS) ‚¨áÔ∏è
        if (filters.zones && filters.zones.length > 0) {
          // M√∫ltiplas zonas: filtro IN direto no campo zona
          query = query.in('zona', filters.zones);
        } else if (filters.zone) {
          // Uma zona: filtro EQ direto no campo zona
          query = query.eq('zona', filters.zone);
        } else if (filters.neighborhood) {
          // Bairros individuais (quando n√£o √© zona completa)
          const bairros = filters.neighborhood.split(',').map(b => b.trim()).filter(Boolean);
          if (bairros.length > 1) {
            query = query.in('bairro', bairros);
          } else {
            query = query.eq('bairro', filters.neighborhood);
          }
        }
        
        // FILTRO DE LOCALIZA√á√ÉO (busca livre)
        if (filters.location) {
          const sanitized = sanitizeSearchInput(filters.location);
          const escaped = escapeSqlLike(sanitized);
          query = query.or(
            `endereco.ilike.%${escaped}%,` +
            `bairro.ilike.%${escaped}%,` +
            `cidade.ilike.%${escaped}%`
          );
        }
        
        // FILTRO DE PALAVRA-CHAVE
        if (filters.keyword) {
          const sanitized = sanitizeSearchInput(filters.keyword);
          const escaped = escapeSqlLike(sanitized);
          query = query.or(
            `titulo_propriedade.ilike.%${escaped}%,` +
            `descricao.ilike.%${escaped}%`
          );
        }
        
        // FILTRO DE SEGUNDO LEIL√ÉO
        if (filters.hasSecondAuction) {
          query = query
            .not('data_leilao_2', 'is', null)
            .not('leilao_2', 'is', null);
        }
        
        // FILTRO DE PRE√áO
        if (filters.priceRange) {
          if (filters.priceRange.min !== undefined) {
            query = query.gte('leilao_1', filters.priceRange.min);
          }
          if (filters.priceRange.max !== undefined) {
            query = query.lte('leilao_1', filters.priceRange.max);
          }
        }
        
        // FILTRO DE TIPO DE LEIL√ÉO
        if (filters.auctionType) {
          if (filters.auctionType === "EXTRAJUDICIAL_CUSTOM") {
            query = query
              .neq('tipo_leilao', 'Judicial')
              .neq('tipo_leilao', 'Outros');
          } else if (filters.auctionType === "EXTRAJUDICIAL_COMPOSTO") {
            query = query
              .neq('tipo_leilao', 'Judicial')
              .neq('tipo_leilao', 'Outros');
          } else if (filters.auctionType === "Judicial") {
            query = query.in('tipo_leilao', ['Judicial', 'Outros']);
          } else {
            query = query.eq('tipo_leilao', filters.auctionType);
          }
        }
        
        // FILTROS DE CARACTER√çSTICAS
        if (filters.financiamento === true) {
          query = query.eq('financiamento', true);
        }
        if (filters.fgts === true) {
          query = query.eq('fgts', true);
        }
        if (filters.parcelamento === true) {
          query = query.eq('parcelamento', true);
        }
        
        // FILTRO DE DATA FINAL DO SEGUNDO LEIL√ÉO
        if (filters.dataFimSegundoLeilao) {
          query = query.lte('data_leilao_2', filters.dataFimSegundoLeilao);
        }
        
        // Obter a data atual para compara√ß√£o
        const currentDateForFilter = new Date();
        
        let countQuery = query;
        
        // Adicionar filtro de data para considerar apenas leil√µes futuros
        if (!filters.dataFimSegundoLeilao) {
          countQuery = countQuery.or(
            `data_leilao_1.is.null,` +
            `data_leilao_1.gte.${currentDateForFilter.toISOString()},` +
            `data_leilao_2.gte.${currentDateForFilter.toISOString()}`
          );
        }
        
        // Obter a contagem total
        const countResult = await countQuery;
        
        if (countResult.error) {
          throw countResult.error;
        }

        const total = countResult.count || 0;
        setTotalCount(total);
        setTotalPages(Math.ceil(total / ITEMS_PER_PAGE));

        // Busca a p√°gina atual
        const from = (currentPage - 1) * ITEMS_PER_PAGE;
        const to = from + ITEMS_PER_PAGE - 1;

        // Aplicar o mesmo filtro de data na query principal
        if (!filters.dataFimSegundoLeilao) {
          query = query.or(
            `data_leilao_1.is.null,` +
            `data_leilao_1.gte.${currentDateForFilter.toISOString()},` +
            `data_leilao_2.gte.${currentDateForFilter.toISOString()}`
          );
        }

        const { data, error } = await query
          .range(from, to)
          .order('data_leilao_1', { ascending: true });

        if (error) {
          throw error;
        }

        // Transforma os dados no formato esperado
        const formattedProperties = data
          .map(item => {
            let data_leilao_1_final = item.data_leilao_1;
            if (!item.data_leilao_1) {
              const futureDate = new Date();
              futureDate.setDate(futureDate.getDate() + 15);
              data_leilao_1_final = futureDate.toISOString();
            }
            
            const data_leilao_2 = item.data_leilao_2 || data_leilao_1_final;
            const leilao_2 = item.leilao_2 || item.leilao_1;

            return {
              id: item.id,
              titulo_propriedade: item.titulo_propriedade || `Leil√£o ${item.tipo_propriedade || 'Im√≥vel'} - ${item.cidade}/${item.estado}`,
              endereco: item.endereco || '',
              bairro: item.bairro || '',
              cidade: item.cidade || '',
              estado: item.estado || '',
              data_leilao_1: formatDate(data_leilao_1_final),
              data_leilao_2: formatDate(data_leilao_2),
              leilao_1: item.leilao_1 || 0,
              leilao_2: leilao_2 || 0,
              area_displayable: '√Årea n√£o informada',
              imagem: item.imagem || 'https://kmiblhbe.manus.space/imovel_sao_goncalo.jpeg',
              descricao: item.descricao,
              data_leilao_1_original: data_leilao_1_final,
              tipo_leilao: item.tipo_leilao,
              fgts: item.fgts,
              financiamento: item.financiamento,
              parcelamento: item.parcelamento,
              zona: item.zona // Campo zona da view
            };
          })
          .sort((a, b) => {
            if (!a.data_leilao_1_original) return 1;
            if (!b.data_leilao_1_original) return -1;
            
            const dateA = new Date(a.data_leilao_1_original);
            const dateB = new Date(b.data_leilao_1_original);
            return dateA.getTime() - dateB.getTime();
          });

        setProperties(formattedProperties);

      } catch (err) {
        console.error('Erro ao buscar im√≥veis:', err);
        setError('N√£o foi poss√≠vel carregar os im√≥veis. Tente novamente mais tarde.');
      } finally {
        setLoading(false);
      }
    };

    fetchProperties();
  }, [currentPage, filters, filtersLoaded]);

  // Fun√ß√£o para formatar datas
  const formatDate = (dateString?: string) => {
    if (!dateString) return '';
    
    try {
      const datePart = dateString.split('T')[0];
      const [year, month, day] = datePart.split('-');
      const date = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
      return date.toLocaleDateString('pt-BR');
    } catch (e) {
      console.error('Erro ao formatar data:', e);
      return '';
    }
  };

  // Fun√ß√£o para formatar valores monet√°rios
  const formatCurrency = (value?: number) => {
    if (!value && value !== 0) return '';
    return value.toLocaleString('pt-BR', {
      style: 'currency',
      currency: 'BRL'
    });
  };
```

### 4.7. Fun√ß√£o para Aplicar Filtros

```typescript
  // Fun√ß√£o para aplicar filtros
  const applyFilters = () => {
    const newFilters: Filters = {};
    
    // Cidade
    if (selectedCities.length > 0 && selectedCities[0] !== "TODO_RJ_STATE") {
      newFilters.city = selectedCities.join(',');
    } else if (selectedCity && selectedCity !== "Selecione a cidade" && selectedCity !== "Todas cidades do RJ") {
      const cityName = selectedCity.split(" (")[0];
      newFilters.city = cityName;
    }
    
    // Tipo
    if (selectedTypes.length > 0) {
      const typeValues = selectedTypes.map(type => type.originalValue || type.label.split(" (")[0]);
      newFilters.type = typeValues.join(',');
    } else if (selectedType && selectedType.label !== "Todos os im√≥veis" && !selectedType.label.includes("tipos selecionados")) {
      newFilters.type = selectedType.originalValue || selectedType.label.split(" (")[0];
    }
    
    // ‚¨áÔ∏è ZONA - DIRETO DA VIEW (SEM EXPANDIR) ‚¨áÔ∏è
    // Verificar se h√° zona selecionada (prioridade sobre bairros individuais)
    const isZoneSelected = selectedNeighborhood && selectedNeighborhood.includes(" (todos)");
    if (isZoneSelected) {
      // Extrair o nome da zona
      const zoneName = selectedNeighborhood.replace(" (todos)", "");
      newFilters.zone = zoneName;
    } else if (selectedNeighborhoods.length > 0) {
      // Se h√° bairros selecionados, verificar se formam uma zona completa
      // Buscar zonas que cont√™m todos os bairros selecionados
      // (Esta l√≥gica pode ser simplificada se voc√™ tiver uma tabela de mapeamento)
      // Por enquanto, usar bairros individuais
      newFilters.neighborhood = selectedNeighborhoods.join(',');
    } else if (selectedNeighborhood && selectedNeighborhood !== "Selecione o bairro") {
      const neighborhoodName = selectedNeighborhood.split(" (")[0];
      newFilters.neighborhood = neighborhoodName;
    }
    
    // Localiza√ß√£o
    if (locationInput) {
      newFilters.location = locationInput;
    }
    
    // Palavra-chave
    if (keywordInput) {
      newFilters.keyword = keywordInput;
    }
    
    // Segundo leil√£o
    if (filterSecondAuction) {
      newFilters.hasSecondAuction = true;
    }
    
    // Data final do segundo leil√£o
    if (dataFimSegundoLeilao) {
      newFilters.dataFimSegundoLeilao = dataFimSegundoLeilao;
    }
    
    // Faixa de pre√ßo
    if (selectedPriceRanges.length > 0) {
      const allMins = selectedPriceRanges.map(range => range.min ?? 0);
      const allMaxs = selectedPriceRanges.filter(range => range.max !== undefined).map(range => range.max!);
      
      newFilters.priceRange = {
        min: Math.min(...allMins),
        max: allMaxs.length > 0 ? Math.max(...allMaxs) : undefined
      };
    } else if (selectedPriceRange && selectedPriceRange.label !== "Todos os pre√ßos" && !selectedPriceRange.label.includes("faixas selecionadas")) {
      newFilters.priceRange = {
        min: selectedPriceRange.min,
        max: selectedPriceRange.max
      };
    }
    
    // Tipo de leil√£o
    if (selectedAuctionTypes.length > 0) {
      let hasJudicial = selectedAuctionTypes.includes(AUCTION_TYPE_JUDICIAL);
      let hasExtrajudicial = selectedAuctionTypes.includes(AUCTION_TYPE_EXTRAJUDICIAL);
      let hasExtrajudicialFinanciamento = selectedAuctionTypes.includes(AUCTION_TYPE_EXTRAJUDICIAL_FINANCIAMENTO);
      
      if (hasExtrajudicial && hasExtrajudicialFinanciamento) {
        newFilters.auctionType = "EXTRAJUDICIAL_COMPOSTO";
        newFilters.financiamento = undefined;
      } else if (hasJudicial) {
        newFilters.auctionType = "Judicial";
        newFilters.financiamento = undefined;
      } else if (hasExtrajudicialFinanciamento) {
        newFilters.auctionType = "EXTRAJUDICIAL_CUSTOM";
        newFilters.financiamento = true;
      } else if (hasExtrajudicial) {
        newFilters.auctionType = "EXTRAJUDICIAL_CUSTOM";
        newFilters.financiamento = undefined;
      }
    } else if (selectedAuctionType && selectedAuctionType !== "Todos os tipos de leil√£o" && !selectedAuctionType.includes("modalidades selecionadas")) {
      if (selectedAuctionType === AUCTION_TYPE_JUDICIAL) {
        newFilters.auctionType = "Judicial";
      } else if (selectedAuctionType === AUCTION_TYPE_EXTRAJUDICIAL_FINANCIAMENTO) {
        newFilters.auctionType = "EXTRAJUDICIAL_CUSTOM";
        newFilters.financiamento = true;
      } else if (selectedAuctionType === AUCTION_TYPE_EXTRAJUDICIAL) {
        newFilters.auctionType = "EXTRAJUDICIAL_CUSTOM";
      }
    }
    
    // M√∫ltiplas faixas de pre√ßo
    if (selectedPriceRanges.length > 0) {
      newFilters.priceRanges = selectedPriceRanges.map(range => range.label);
    }
    
    // Aplicar filtros
    setFilters(newFilters);
    
    // Atualizar URL com os filtros aplicados
    updateURL(newFilters);
    
    // Resetar para a primeira p√°gina quando aplicar filtros
    setCurrentPage(1);
    
    // Notifica√ß√£o
    toast.success('Filtros aplicados com sucesso!');
    
    // Fechar painel de filtros no mobile
    if (isMobile) {
      setIsFilterOpen(false);
    }
  };
```

### 4.8. Fun√ß√£o para Buscar Bairros por Cidade (da VIEW)

```typescript
  // Fun√ß√£o para buscar bairros por cidade da VIEW
  const fetchNeighborhoodsByCity = async (cityName: string) => {
    if (!cityName) return;
    try {
      const { data, error } = await supabase
        .from('leiloes_imoveis_com_zona') // ‚¨ÖÔ∏è USAR A VIEW
        .select('bairro, zona') // Buscar bairro E zona
        .eq('estado', 'RJ')
        .gte('leilao_1', 75000)
        .eq('cidade', cityName)
        .order('bairro')
        .not('bairro', 'is', null);
        
      if (error) throw error;
      
      const neighborhoodCount: Record<string, number> = {};
      const neighborhoodsByZone: Record<string, string[]> = {};
      
      data.forEach(item => {
        if (item.bairro && item.bairro.trim() !== '') {
          neighborhoodCount[item.bairro] = (neighborhoodCount[item.bairro] || 0) + 1;
          
          // Agrupar por zona se houver
          if (item.zona) {
            if (!neighborhoodsByZone[item.zona]) {
              neighborhoodsByZone[item.zona] = [];
            }
            if (!neighborhoodsByZone[item.zona].includes(item.bairro)) {
              neighborhoodsByZone[item.zona].push(item.bairro);
            }
          }
        }
      });
      
      // Se for Rio de Janeiro, agrupar por zona
      if (cityName.toLowerCase() === 'rio de janeiro') {
        const bairrosAgrupados: Record<string, { neighborhood: string, count: number }[]> = {};
        
        // Agrupar bairros por zona
        Object.keys(neighborhoodsByZone).forEach(zona => {
          bairrosAgrupados[zona] = neighborhoodsByZone[zona].map(bairro => ({
            neighborhood: bairro,
            count: neighborhoodCount[bairro] || 0
          }));
        });
        
        // Adicionar bairros sem zona em "Outros"
        Object.keys(neighborhoodCount).forEach(bairro => {
          let foundInZone = false;
          Object.values(neighborhoodsByZone).forEach(zoneBairros => {
            if (zoneBairros.includes(bairro)) {
              foundInZone = true;
            }
          });
          
          if (!foundInZone) {
            if (!bairrosAgrupados['Outros']) bairrosAgrupados['Outros'] = [];
            bairrosAgrupados['Outros'].push({ 
              neighborhood: bairro, 
              count: neighborhoodCount[bairro] 
            });
          }
        });
        
        setRjNeighborhoods(bairrosAgrupados);
      } else {
        // Para outras cidades, lista simples
        const neighborhoodsArray = Object.keys(neighborhoodCount)
          .filter(neighborhood => neighborhood.trim() !== '')
          .map(neighborhood => ({
            neighborhood,
            count: neighborhoodCount[neighborhood]
          }))
          .sort((a, b) => {
            if (b.count !== a.count) {
              return b.count - a.count;
            }
            return a.neighborhood.localeCompare(b.neighborhood, 'pt-BR');
          });
        setRjNeighborhoods(neighborhoodsArray);
      }
    } catch (err) {
      console.error(`Erro ao buscar bairros de ${cityName}:`, err);
    }
  };
```

### 4.9. Fun√ß√µes de Sele√ß√£o de Zona

```typescript
  // Fun√ß√£o para selecionar zona (direto da view)
  const selectZone = (zone: string) => {
    setSelectedNeighborhood(`${zone} (todos)`);
    setSelectedNeighborhoods([]); // N√£o precisa expandir bairros
    setShowNeighborhoodMenu(false);
    
    // Aplicar filtros imediatamente com a zona
    const newFilters: Filters = {
      zone: zone
    };
    
    // Manter outros filtros existentes
    if (selectedCities.length > 0 && selectedCities[0] !== "TODO_RJ_STATE") {
      newFilters.city = selectedCities.join(',');
    }
    
    if (selectedTypes.length > 0) {
      const typeValues = selectedTypes.map(type => type.originalValue || type.label.split(" (")[0]);
      newFilters.type = typeValues.join(',');
    }
    
    if (locationInput) {
      newFilters.location = locationInput;
    }
    
    if (keywordInput) {
      newFilters.keyword = keywordInput;
    }
    
    if (filterSecondAuction) {
      newFilters.hasSecondAuction = true;
    }
    
    if (selectedPriceRange && selectedPriceRange.label !== "Todos os pre√ßos") {
      newFilters.priceRange = {
        min: selectedPriceRange.min,
        max: selectedPriceRange.max
      };
    }
    
    updateURL(newFilters);
    setFilters(newFilters);
    setCurrentPage(1);
  };

  // Fun√ß√£o para toggle de zona (m√∫ltipla sele√ß√£o)
  const toggleZone = (zone: string) => {
    // Verificar se a zona j√° est√° selecionada
    const isZoneSelected = filters.zones?.includes(zone) || filters.zone === zone;
    
    if (isZoneSelected) {
      // Remover zona
      if (filters.zones && filters.zones.length > 1) {
        const newZones = filters.zones.filter(z => z !== zone);
        if (newZones.length === 1) {
          setFilters({ ...filters, zones: undefined, zone: newZones[0] });
        } else {
          setFilters({ ...filters, zones: newZones });
        }
      } else {
        setFilters({ ...filters, zone: undefined, zones: undefined });
        setSelectedNeighborhood("Selecione o bairro");
      }
    } else {
      // Adicionar zona
      if (filters.zone) {
        // Se j√° tem uma zona, converter para array
        setFilters({ ...filters, zone: undefined, zones: [filters.zone, zone] });
      } else if (filters.zones) {
        // Se j√° tem m√∫ltiplas zonas, adicionar mais uma
        setFilters({ ...filters, zones: [...filters.zones, zone] });
      } else {
        // Primeira zona
        setFilters({ ...filters, zone });
      }
      
      setSelectedNeighborhood(`${zone} (todos)`);
    }
    
    updateURL(filters);
    setCurrentPage(1);
  };
```

### 4.10. Front-end dos Filtros (JSX)

O front-end completo est√° no arquivo `Index.tsx` original. As principais se√ß√µes s√£o:

1. **Dropdown de Tipo de Im√≥vel** - M√∫ltipla sele√ß√£o com checkboxes
2. **Dropdown de Cidades** - M√∫ltipla sele√ß√£o, agrupado por regi√£o
3. **Dropdown de Bairros** - M√∫ltipla sele√ß√£o, agrupado por zona (quando Rio de Janeiro)
4. **Dropdown de Faixas de Pre√ßo** - M√∫ltipla sele√ß√£o
5. **Dropdown de Modalidade de Leil√£o** - M√∫ltipla sele√ß√£o
6. **Campo de Data de Encerramento** - Input date
7. **Campo de Busca R√°pida** - Input text
8. **Bot√µes de Buscar e Limpar**

---

## 5. Configura√ß√µes e Constantes

### 5.1. Faixas de Pre√ßo

```typescript
const priceRanges: PriceRange[] = [
  { label: 'Todos os pre√ßos' },
  { label: 'At√© R$ 300k', max: 300000 },
  { label: 'R$ 300k a R$ 500k', min: 300000, max: 500000 },
  { label: 'R$ 500k a R$ 750k', min: 500000, max: 750000 },
  { label: 'R$ 750k a R$ 1M', min: 750000, max: 1000000 },
  { label: 'R$ 1M a R$ 1.5M', min: 1000000, max: 1500000 },
  { label: 'R$ 1.5M a R$ 2M', min: 1500000, max: 2000000 },
  { label: 'Acima de R$ 2M', min: 2000000 }
];
```

### 5.2. Tipos de Leil√£o

```typescript
const AUCTION_TYPE_JUDICIAL = "JUDICIAL";
const AUCTION_TYPE_EXTRAJUDICIAL = "EXTRAJUDICIAL";
const AUCTION_TYPE_EXTRAJUDICIAL_FINANCIAMENTO = "EXTRAJUDICIAL FINANCI√ÅVEL";
```

---

## üîë Diferen√ßas Principais - View `leiloes_imoveis_com_zona`

### 1. Tabela/View Usada

**Antes:**
```typescript
.from('leiloes_imoveis')
```

**Agora:**
```typescript
.from('leiloes_imoveis_com_zona') // ‚¨ÖÔ∏è VIEW COM ZONA
```

### 2. Filtro de Zona

**Antes:** Expandia zona para lista de bairros
```typescript
if (filters.zone) {
  const bairrosDaZona = bairrosPorZonaRJ[filters.zone] || [];
  query = query.in('bairro', bairrosDaZona);
}
```

**Agora:** Filtro direto no campo `zona` da view
```typescript
if (filters.zone) {
  query = query.eq('zona', filters.zone);
}
```

### 3. Buscar Zonas Dispon√≠veis

**Novo:** Buscar zonas diretamente da view
```typescript
const fetchZones = async () => {
  const { data, error } = await supabase
    .from('leiloes_imoveis_com_zona')
    .select('zona')
    .eq('estado', 'RJ')
    .gte('leilao_1', 75000)
    .not('zona', 'is', null);
    
  const uniqueZones = [...new Set(data.map(item => item.zona).filter(Boolean))];
  setZones(uniqueZones.sort());
};
```

---

## üìù Resumo das Mudan√ßas

1. ‚úÖ **Todas as queries** usam `leiloes_imoveis_com_zona` em vez de `leiloes_imoveis`
2. ‚úÖ **Filtro de zona** usa campo `zona` diretamente (n√£o expande para bairros)
3. ‚úÖ **Busca de zonas** vem diretamente da view
4. ‚úÖ **Front-end** permanece igual (dropdowns, m√∫ltipla sele√ß√£o, etc.)
5. ‚úÖ **Slugs na URL** funcionam igual (par√¢metros: `?zona=Zona Sul (Rio de Janeiro)`)

---

## üéØ Exemplo de URL com Filtros

```
/?cidade=Rio de Janeiro&zona=Zona Sul (Rio de Janeiro)&tipo=Apartamento&preco_min=300000&preco_max=1000000&financiamento=true
```

---

**Pronto!** Agora voc√™ tem todo o c√≥digo necess√°rio para implementar o sistema de filtros usando a view `leiloes_imoveis_com_zona`. üöÄ

